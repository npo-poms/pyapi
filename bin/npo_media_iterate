#!/usr/bin/env python3
"""
  Simple client to search media in the  NPO Frontend API
"""
from npoapi import Media
import sys
import os

client = Media()\
    .command_line_client(description="Iterate the NPO Frontend API")
client.add_argument('profile', type=str, nargs='?')
client.add_argument('form', type=str, nargs='?',
                    help='The search form. This may be a json string, or the name of a file containing it')
client.add_argument('-m', "--max", type=int, default="100")

args = client.parse_args()

response = client.iterate(profile=args.profile, form=args.form, limit=args.max)

buffer = bytearray("-" * 10000, "ascii")
totalcount = 0
while not response.closed:
    sys.stderr.write('.')
    os.write(sys.stderr.fileno(), bytes(".", 'UTF-8'))
    result = response.readinto(buffer)
    os.write(sys.stdout.fileno(), buffer[0:result])
    totalcount += result
    if result < len(buffer):
        response.close()
        break

sys.stderr.write("\n%d byte written\n" % totalcount)
client.exit()
