#!/usr/bin/env python3
"""
  Simple client to get the changes feed from the NPO Frontend API
"""
from npoapi import Media
from io import TextIOWrapper
from sys import stdout

client = Media().command_line_client("Get changes feed from the NPO Frontend API", exclude_arguments={"accept"})
client.add_argument('profile', type=str, nargs='?', help='Profile')
client.add_argument("-s", "--since", type=str, default=None)
client.add_argument('-m', "--max", type=int, default="100")
client.add_argument("--backwards", action="store_true")
client.add_argument('-p', "--properties", type=str, default=None,
                    help="properties filtering")

args = client.parse_args()
response = TextIOWrapper(client.changes(
    profile=args.profile, 
    since=args.since, 
    limit=args.max, 
    force_oldstyle=args.backwards,
    properties=args.properties,
    stream=True), encoding="UTF-8")

buffer = response.read(1024)
while len(buffer) > 0:
    stdout.write(buffer)
    buffer = response.read(1024)
response.close()
stdout.flush()
client.exit()
